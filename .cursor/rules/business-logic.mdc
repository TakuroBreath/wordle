---
description:
globs:
alwaysApply: false
---
# Бизнес-логика

## Создание пользователя
- При первом входе через Telegram Mini App создается пользователь
- Баланс инициализируется нулевыми значениями
- Статистика побед/поражений начинается с нуля

## Создание игры
- Игрок задает параметры игры:
  - Слово
  - Максимальное количество попыток
  - Множитель награды
  - Минимальную и максимальную ставки
- Вычисляется max_reward = max_bet * multiplier
- Создатель переводит депозит в reward pool
- После подтверждения транзакции игра становится активной

## Присоединение к игре
- Игрок выбирает ставку (в пределах min_bet - max_bet)
- Создается лобби с пустым списком попыток
- Вычисляется потенциальный выигрыш
- Лобби активно 5 минут

## Попытка угадать слово
- Игрок отправляет слово
- Бэкенд возвращает массив результатов:
  - 0 - буквы нет
  - 1 - буква есть, не на месте
  - 2 - буква есть и на месте
- Попытка сохраняется
- При угадывании:
  - Статус лобби = success
  - Начисляется выигрыш на баланс игрока
- При проигрыше:
  - Статус = failed
  - Ставка переходит в reward pool игры

## Выплата наград
- Победа: выигрыш начисляется игроку
- Проигрыш: ставка остается в reward pool
- Комиссия сервиса: 5%
- Создатель может удалить игру и получить reward pool
- Игрок может запросить вывод средств с баланса
