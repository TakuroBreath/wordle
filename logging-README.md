# Система логирования для Wordle Game

## Обзор

Система логирования Wordle Game построена на основе ELK Stack (Elasticsearch, Logstash, Kibana) с Filebeat для сбора логов. Эта система обеспечивает:

1. Централизованный сбор и хранение логов
2. Структурированные логи с контекстом (включая трейсинг)
3. Автоматическую ротацию логов
4. Алертинг на критические ошибки

## Архитектура системы

```
┌─────────────┐     ┌─────────┐     ┌──────────┐     ┌──────────────┐     ┌────────┐
│ Приложение  │────▶│ Filebeat│────▶│ Logstash │────▶│ Elasticsearch│────▶│ Kibana │
└─────────────┘     └─────────┘     └──────────┘     └──────────────┘     └────────┘
       │                                                      │
       │                                                      │
       │                                                      ▼
       │                                             ┌──────────────┐
       └────────────────────────────────────────────▶│   Алерты    │
                                                     └──────────────┘
```

## Компоненты

1. **Приложение** - генерирует структурированные логи (JSON) с контекстом
2. **Filebeat** - агент для сбора и отправки логов в Logstash
3. **Logstash** - обрабатывает и фильтрует логи перед отправкой в Elasticsearch
4. **Elasticsearch** - хранит и индексирует логи
5. **Kibana** - визуализирует логи и позволяет осуществлять поиск
6. **Алерты** - система уведомлений о критических ошибках

## Запуск системы

```bash
docker-compose -f docker-compose.logging.yml up -d
```

## Доступ к компонентам

- **Kibana**: http://localhost:5601
- **Elasticsearch**: http://localhost:9200
- **Logstash**: http://localhost:9600

## Структура логов

Логи имеют следующую структуру:

```json
{
  "timestamp": "2023-07-27T12:34:56.789Z",
  "level": "info",
  "message": "Сообщение",
  "logger": "app",
  "caller": "app.go:123",
  "trace_id": "1234567890abcdef",
  "span_id": "abcdef1234567890",
  "service": "wordle-api",
  "method": "GetGame",
  "game_id": "abc-123-def-456",
  "user_id": 123456
}
```

## Настройка логирования в приложении

Настройки логирования можно изменить через переменные окружения:

- `LOG_LEVEL` - уровень логирования (debug, info, warn, error, fatal)
- `LOG_FORMAT` - формат логов (json, console)
- `LOG_OUTPUT` - вывод логов (stdout, file)
- `LOG_FILE_PATH` - путь к файлу логов
- `LOG_MAX_SIZE` - максимальный размер файла логов в МБ
- `LOG_MAX_BACKUPS` - максимальное количество файлов бэкапов
- `LOG_MAX_AGE` - максимальное время хранения бэкапов в днях
- `LOG_COMPRESS` - сжатие файлов бэкапов

## Алерты

Система автоматически отправляет уведомления при возникновении критических ошибок. Настройки алертов находятся в конфигурации Logstash.

## Правила использования в коде

```go
// Базовое логирование
logger.Log.Info("Сообщение", zap.String("key", "value"))

// Логирование с контекстом
logger.LogInfo(ctx, "Сообщение", zap.Int("user_id", 123))

// Логирование ошибок
logger.LogError(ctx, "Произошла ошибка", err, zap.String("game_id", "abc-123"))
```

## Мониторинг и отладка

В Kibana доступны следующие дашборды:

1. **Обзор системы** - общая статистика
2. **Ошибки** - анализ ошибок по типам и сервисам
3. **API** - мониторинг API запросов
4. **Бизнес-метрики** - метрики бизнес-процессов

## Интеграция с трейсингом

Система логирования интегрирована с системой трейсинга Jaeger. Все логи содержат trace_id и span_id, что позволяет коррелировать логи и трейсы.

## Ротация логов

Ротация логов выполняется автоматически на основе следующих параметров:
- Максимальный размер файла: 100 МБ
- Максимальное количество файлов: 30
- Максимальное время хранения: 30 дней
- Сжатие файлов: включено 