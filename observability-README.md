# Система мониторинга и логирования Wordle Game

## Обзор

Система наблюдаемости (Observability) для Wordle Game состоит из трех компонентов:

1. **Метрики** - Prometheus + Grafana
2. **Логирование** - ELK Stack (Elasticsearch, Logstash, Kibana) + Filebeat
3. **Трейсинг** - Jaeger (OpenTelemetry)

Эта комплексная система обеспечивает полную видимость работы приложения, что позволяет:
- Отслеживать производительность и доступность сервисов
- Анализировать ошибки и проблемы в режиме реального времени
- Получать уведомления о критических ситуациях
- Визуализировать поведение системы и бизнес-метрики

## Архитектура системы

```
                                  ┌─────────────┐
                                  │             │
                              ┌──▶│   Grafana   │◀─┐
                              │   │             │  │
                              │   └─────────────┘  │
                              │                    │
┌─────────────┐     ┌─────────┴─────┐     ┌────────┴───────┐
│             │     │               │     │                │
│  Приложение │────▶│   Prometheus  │────▶│  Elasticsearch │
│             │     │               │     │                │
└─────┬───────┘     └───────────────┘     └────────┬───────┘
      │                                            │
      │                                            │
      │                                            ▼
      │                                    ┌──────────────┐
      │                                    │              │
      │                                    │    Kibana    │
      │                                    │              │
      │                                    └──────────────┘
      │
      │           ┌─────────────┐
      │           │             │
      └──────────▶│    Jaeger   │
                  │             │
                  └─────────────┘
```

## Компоненты

### Метрики (Prometheus + Grafana)

Prometheus собирает метрики из приложения через HTTP-эндпоинт `/metrics`. Grafana используется для визуализации этих метрик.

#### Собираемые метрики

1. **HTTP-метрики**:
   - `http_request_duration_seconds` - время выполнения запросов
   - `http_requests_total` - количество запросов
   - `errors_total` - количество ошибок

2. **Бизнес-метрики**:
   - `wordle_game_start_total` - количество начатых игр
   - `wordle_game_complete_total` - количество завершенных игр
   - `wordle_game_abandoned_total` - количество брошенных игр
   - `wordle_active_games` - текущее количество активных игр
   - `wordle_word_guessed_total` - статистика угаданных слов по количеству попыток

### Логирование (ELK Stack + Filebeat)

ELK Stack используется для централизованного сбора, хранения и анализа логов.

#### Компоненты логирования

1. **Filebeat** - собирает логи из Docker-контейнеров
2. **Logstash** - обрабатывает и фильтрует логи
3. **Elasticsearch** - хранит и индексирует логи
4. **Kibana** - визуализирует логи

#### Структура логов

Логи имеют следующую структуру:

```json
{
  "timestamp": "2023-07-27T12:34:56.789Z",
  "level": "info",
  "message": "Сообщение",
  "logger": "app",
  "caller": "app.go:123",
  "trace_id": "1234567890abcdef",
  "span_id": "abcdef1234567890",
  "service": "wordle-api",
  "method": "GetGame",
  "game_id": "abc-123-def-456",
  "user_id": 123456
}
```

### Трейсинг (Jaeger)

Jaeger используется для трассировки запросов через систему, что позволяет анализировать путь запроса и выявлять узкие места.

## Запуск системы

Для запуска полной системы мониторинга и логирования:

```bash
docker-compose -f docker-compose.full.yml up -d
```

## Доступ к компонентам

- **Grafana**: http://localhost:3000 (логин: admin, пароль: secret)
- **Prometheus**: http://localhost:9091
- **Kibana**: http://localhost:5601
- **Jaeger UI**: http://localhost:16686
- **Elasticsearch API**: http://localhost:9200

## Настройка алертов

### Prometheus Alertmanager

Alertmanager настроен на отправку уведомлений при следующих событиях:
- Высокая латентность API (>1s)
- Высокая частота ошибок (>5%)
- Недоступность сервисов

### Logstash алерты

Настроена отправка уведомлений при возникновении критических ошибок (уровень логирования: ERROR, FATAL).

## Дашборды

### Grafana

1. **Обзор системы** - общая статистика по сервисам
2. **API-метрики** - детальная информация по API-запросам
3. **Бизнес-метрики** - статистика игр и пользовательской активности
4. **Ресурсы** - мониторинг потребления ресурсов (CPU, память, диск)

### Kibana

1. **Логи по уровням** - визуализация логов по уровням (INFO, WARN, ERROR, FATAL)
2. **Ошибки** - детальный анализ ошибок
3. **Бизнес-события** - анализ бизнес-событий по типам

## Интеграция компонентов

Система наблюдаемости интегрирована следующим образом:
1. **Корреляция логов и трейсов** - все логи содержат trace_id и span_id
2. **Метрики и алерты** - алерты Prometheus могут быть настроены на основе метрик
3. **Визуализация трейсов в Grafana** - Grafana может отображать трейсы из Jaeger

## Рекомендации по использованию

1. **Мониторинг в реальном времени** - используйте дашборды Grafana для мониторинга системы в реальном времени
2. **Анализ инцидентов** - используйте Kibana для анализа логов и Jaeger для анализа трейсов при расследовании инцидентов
3. **Настройка алертов** - настраивайте алерты для раннего обнаружения проблем
4. **Регулярный аудит** - регулярно анализируйте метрики и логи для выявления потенциальных проблем

## Развитие системы

Рекомендации по развитию системы наблюдаемости:
1. Добавить распределенное трейсинг для микросервисов
2. Интегрировать системы с внешними сервисами мониторинга (Datadog, New Relic)
3. Настроить автоматические действия при алертах (автомасштабирование, автоматическое восстановление) 